<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MOP_PREPROCESS &mdash; Master of Pores 2  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MOP_TAIL" href="mop_tail.html" />
    <link rel="prev" title="How to install" href="install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Master of Pores 2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About Master of Pores</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">How to install</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MOP_PREPROCESS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#input-parameters">Input Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-run-the-pipeline">How to run the pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="#results">Results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mop_tail.html">MOP_TAIL</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmark.html">Benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">CHANGELOG</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Master of Pores 2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>MOP_PREPROCESS</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mop-preprocess">
<span id="home-page-moprepr"></span><h1>MOP_PREPROCESS<a class="headerlink" href="#mop-preprocess" title="Permalink to this headline"></a></h1>
<p>This module takes as input the raw fast5 reads - single or multi - and produces a number of outputs (basecalled fast5, sequences in fastq format, aligned reads in BAM format etc). The pre-processing module is able to perform base-calling, demultiplexing (optional), filtering, quality control, mapping to a genome / transcriptome reference, feature counting, discovery of novel transcripts and it generates a final report of the performance and results of each of the steps performed. It automatically detects the kind of input fast5 file (single or multi sequence).</p>
<section id="input-parameters">
<h2>Input Parameters<a class="headerlink" href="#input-parameters" title="Permalink to this headline"></a></h2>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>conffile</strong></p></td>
<td><p>Configuration file produced by the Nanopore instrument. It can be omitted but in that case the user must specify either the guppy parameters “–kit” and “–flowcell” or the custom model via <strong>[NAME_tool_opt.tsv]</strong> file</p></td>
</tr>
<tr class="row-odd"><td><p><strong>fast5 files</strong></p></td>
<td><p>Path to fast5 input files (single or multi-fast5 files). They should be inside folders that will be used as sample name. <strong>[/Path/**/*.fast5]</strong>. If empty it will search for fastq files and skip basecalling</p></td>
</tr>
<tr class="row-even"><td><p><strong>fastq files</strong></p></td>
<td><p>Path to fastq input files. They should be inside folders that will be used as sample name. Must be empty if you want to perform basecalling <strong>[/Path/**/*.fastq]</strong>.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>reference</strong></p></td>
<td><p>File in fasta format. <strong>[Reference_file.fa]</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>ref_type</strong></p></td>
<td><p>Specify if the reference is a genome or a transcriptome. <strong>[genome / transcriptome]</strong></p></td>
</tr>
<tr class="row-odd"><td><p><strong>annotation</strong></p></td>
<td><p>Annotation file in GTF format. It is optional and needed only in case of mapping to the genome and when interested in gene counts. Can be gzipped. <strong>[Annotation_file.gtf]</strong>.</p></td>
</tr>
<tr class="row-even"><td><p><strong>pars_tools</strong></p></td>
<td><p>Parameters of tools. It is ha tab separated file with custom parameters for each tool <strong>[NAME_tool_opt.tsv]</strong></p></td>
</tr>
<tr class="row-odd"><td><p><strong>output</strong></p></td>
<td><p>Output folder name. <strong>[/Path/to_output_folder]</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>qualityqc</strong></p></td>
<td><p>Quality threshold for QC. <strong>[5]</strong></p></td>
</tr>
<tr class="row-odd"><td><p><strong>granularity</strong></p></td>
<td><p>indicates the number of input fast5 files analyzed in a single process.</p></td>
</tr>
<tr class="row-even"><td><p><strong>basecalling</strong></p></td>
<td><p>Tool for basecalling <strong>[guppy / NO ]</strong></p></td>
</tr>
<tr class="row-odd"><td><p><strong>GPU</strong></p></td>
<td><p>Allow the pipeline to run with GPU. <strong>[OFF / ON]</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>demultiplexing</strong></p></td>
<td><p>Tool for demultiplexing algorithm. <strong>[deeplexicon / guppy / NO ]</strong></p></td>
</tr>
<tr class="row-odd"><td><p><strong>demulti_fast5</strong></p></td>
<td><p>If performing demultiplexing generate demultiplexed multifast5 files too. <strong>[YES / NO]</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>filtering</strong></p></td>
<td><p>Tool for filtering fastq files. <strong>[nanofilt / NO]</strong></p></td>
</tr>
<tr class="row-odd"><td><p><strong>mapping</strong></p></td>
<td><p>Tool for mapping reads. <strong>[minimap2 / graphmap / graphmap2 / NO ]</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>counting</strong></p></td>
<td><p>Tool for gene or transcripts counts <strong>[htseq / nanocount / NO””]</strong></p></td>
</tr>
<tr class="row-odd"><td><p><strong>discovery</strong></p></td>
<td><p>Tool for generating novel transcripts. <strong>[bambu / isoquant / NO]</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>cram_conv</strong></p></td>
<td><p>Converting bam in cram. <strong>[YES / “”]</strong></p></td>
</tr>
<tr class="row-odd"><td><p><strong>subsampling_cram</strong></p></td>
<td><p>Subsampling BAM before CRAM conversion. <strong>[YES / “”]</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>saveSpace</strong></p></td>
<td><p>Remove intermediate files (<strong>beta</strong>) <strong>[YES / “”]</strong></p></td>
</tr>
<tr class="row-odd"><td><p><strong>email</strong></p></td>
<td><p>Users email for receving the final report when the pipeline is finished. <strong>[user_email]</strong></p></td>
</tr>
</tbody>
</table>
<p>You can change them by editing the <strong>params.config</strong> file or using the command line - please, see next section.</p>
</section>
<section id="how-to-run-the-pipeline">
<h2>How to run the pipeline<a class="headerlink" href="#how-to-run-the-pipeline" title="Permalink to this headline"></a></h2>
<p>Before launching the pipeline, user should decide which containers to use - either docker or singularity <strong>[-with-docker / -with-singularity]</strong>.</p>
<p>Then, to launch the pipeline, please use the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nextflow run mop_preprocess.nf -with-singularity &gt; log.txt</span>
</pre></div>
</div>
<p>You can run the pipeline in the background adding the nextflow parameter <strong>-bg</strong>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nextflow run mop_preprocess.nf -with-singularity -bg &gt; log.txt</span>
</pre></div>
</div>
<p>You can change the parameters either by changing <strong>params.config</strong> file or by feeding the parameters via command line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nextflow run mop_preprocess.nf -with-singularity -bg --output test2 &gt; log.txt</span>
</pre></div>
</div>
<p>You can specify a different working directory with temporary files:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nextflow run mop_preprocess.nf -with-singularity -bg -w /path/working_directory &gt; log.txt</span>
</pre></div>
</div>
<p>You can use different profiles specifying the different environments. We have one set up for HPC using the SGE scheduler:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nextflow run mop_preprocess.nf -with-singularity -bg -w /path/working_directory -profile cluster &gt; log.txt</span>
</pre></div>
</div>
<p>or you can run the pipeline locally:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">nextflow run mop_preprocess.nf -with-singularity -bg -w /path/working_directory -profile local &gt; log.txt</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>In case of errors you can troubleshoot seeing the log file (log.txt) for more details. Furthermore, if more information is needed, you can also find the working directory of the process in the file. Then, access that directory indicated by the error output and check both the <cite>.command.log</cite> and <cite>.command.err</cite> files.</p></li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Once the error has been solved or if you change a specific parameter, you can resume the execution with the <strong>Netxtlow</strong> parameter <strong>- resume</strong> (only one dash!). If there was an error, the pipeline will resume from the process that had the error and proceed with the rest.    If a parameter was changed, only processes affected by this parameter will be re-run.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">...</span>

<span class="go">[warm up] executor &gt; crg</span>
<span class="go">[e8/2e64bd] Cached process &gt; baseCalling (RNA081120181_1)</span>
<span class="go">[b2/21f680] Cached process &gt; QC (RNA081120181_1)</span>
<span class="go">[c8/3f5d17] Cached process &gt; mapping (RNA081120181_1)</span>
<span class="go">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To resume the execution, temporary files generated previously by the pipeline must be kept. Otherwise, pipeline will re-start from the beginning.</p>
</div>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline"></a></h2>
<p>Several folders are created by the pipeline within the output directory specified by the <strong>output</strong> parameter:</p>
<ul class="simple">
<li><p><strong>fast5_files</strong>: Contains the basecalled multifast5 files. Each batch contains 4000 sequences.</p></li>
<li><p><strong>fastq_files</strong>: Contains one or, in case of demultiplexing, more fastq files.</p></li>
<li><p><strong>QC_files</strong>: Contains each single QC produced by the pipeline.</p></li>
<li><p><strong>alignment</strong>: Contains the bam file(s).</p></li>
<li><p><strong>cram_files</strong>: Contains the cram file(s).</p></li>
<li><p><strong>counts</strong>: Contains read counts per gene / transcript if counting was performed.</p></li>
<li><p><strong>assigned</strong>: Contains assignment of each read to a given gene / transcript if counting was performed.</p></li>
<li><p><strong>report</strong>: Contains the final multiqc report.</p></li>
<li><p><strong>assembly</strong>: It contains assembled transcripts.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="install.html" class="btn btn-neutral float-left" title="How to install" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mop_tail.html" class="btn btn-neutral float-right" title="MOP_TAIL" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, CRG.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>